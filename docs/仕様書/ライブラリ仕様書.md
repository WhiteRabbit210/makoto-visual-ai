# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜æ›¸

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç›®çš„](#ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç›®çš„)
3. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ ](#ãƒ‡ãƒ¼ã‚¿æ§‹é€ )
   - [ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹é€ ](#ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹é€ )
   - [ãƒ©ã‚¤ãƒ–ãƒ©ãƒª](#ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
   - [ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«](#ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«)
   - [ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿](#ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿)
   - [RAGãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯](#ragãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯)
4. [å…¬é–‹ç¯„å›²ã®ä»•æ§˜](#å…¬é–‹ç¯„å›²ã®ä»•æ§˜)
   - [å…¬é–‹ç¯„å›²ã®ç¨®é¡](#å…¬é–‹ç¯„å›²ã®ç¨®é¡)
   - [ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯](#ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯)
5. [å‡¦ç†ãƒ•ãƒ­ãƒ¼](#å‡¦ç†ãƒ•ãƒ­ãƒ¼)
   - [ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰](#ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)
   - [ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†](#ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†)
   - [RAGæ¤œç´¢](#ragæ¤œç´¢)
   - [ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡](#ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡)
6. [RAGãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ©Ÿèƒ½](#ragãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ©Ÿèƒ½)
   - [ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯UI](#ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ui)
   - [ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç®¡ç†](#ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç®¡ç†)
7. [APIä»•æ§˜](#apiä»•æ§˜)
8. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …)
9. [æ›´æ–°å±¥æ­´](#æ›´æ–°å±¥æ­´)

## æ¦‚è¦

MAKOTO Visual AIã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã¯ã€RAGï¼ˆRetrieval-Augmented Generationï¼‰ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’OpenAIã®text-embedding-3-largeãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã€LLMãŒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

### RAGã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆFAISSç‰ˆï¼‰

```mermaid
graph TB
    subgraph "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰"
        UI[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹]
    end
    
    subgraph "APIå±¤"
        APIGW[API Gateway]
        Auth[èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹]
    end
    
    subgraph "å‡¦ç†å±¤"
        Upload[ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†]
        Search[æ¤œç´¢å‡¦ç†<br/>+FAISSã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹]
        Vector[ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†]
    end
    
    subgraph "ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"
        S3[(S3/Blob Storage<br/>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ãƒ»FAISSã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)]
        DDB[(DynamoDB/CosmosDB<br/>ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿)]
    end
    
    subgraph "å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹"
        OpenAI[OpenAI API<br/>text-embedding-3-large]
        LLM[LLM<br/>Claude/GPT]
    end
    
    subgraph "éåŒæœŸå‡¦ç†"
        Queue[SQS/Queue]
        Lambda[Lambda/Functions]
    end
    
    UI -->|æ¤œç´¢ã‚¯ã‚¨ãƒª| APIGW
    UI -->|ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰| APIGW
    APIGW --> Auth
    Auth --> Upload
    Auth --> Search
    
    Upload --> S3
    Upload --> DDB
    Upload --> Queue
    Queue --> Lambda
    Lambda --> Vector
    
    Vector --> S3
    Vector --> OpenAI
    Vector --> DDB
    
    Search --> S3
    Search --> OpenAI
    Search --> LLM
    
    style OpenAI fill:#f9f,stroke:#333,stroke-width:2px
    style LLM fill:#f9f,stroke:#333,stroke-width:2px
```

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç›®çš„

1. **çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã®æ§‹ç¯‰**
   - çµ„ç¹”å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’LLMãŒå‚ç…§å¯èƒ½ãªå½¢å¼ã§ç®¡ç†
   - PDFã‚„ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã®æ§‹é€ åŒ–ã•ã‚Œã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨

2. **ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã®å®Ÿç¾**
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦é«˜é€Ÿãªé¡ä¼¼æ¤œç´¢ã‚’å¯èƒ½ã«
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„æƒ…å ±ã‚’æŠ½å‡º

3. **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**
   - éƒ¨ç½²ã€å½¹è·ã€å€‹äººå˜ä½ã§ã®ç´°ã‹ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
   - æ©Ÿå¯†æƒ…å ±ã®é©åˆ‡ãªç®¡ç†

## ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®é¸æŠ

### ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã¯
ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€é«˜æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ï¼ˆã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã‚’åŠ¹ç‡çš„ã«ä¿å­˜ãƒ»æ¤œç´¢ã™ã‚‹ãŸã‚ã®å°‚ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚å¾“æ¥ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ç•°ãªã‚Šã€é¡ä¼¼æ€§æ¤œç´¢ï¼ˆã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã€ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢ç­‰ï¼‰ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

### AWSç’°å¢ƒã§ã®é¸æŠè‚¢

#### 1. Amazon OpenSearch Serviceï¼ˆæ¨å¥¨ï¼‰
```typescript
// AWS ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒ¼ãƒ“ã‚¹
{
  service: "Amazon OpenSearch Service",
  features: {
    knn_plugin: true,           // k-NNï¼ˆkè¿‘å‚æ³•ï¼‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å¯¾å¿œ
    dimensions: 16000,          // æœ€å¤§æ¬¡å…ƒæ•°
    index_types: ["HNSW", "IVF"],  // é«˜é€Ÿæ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
    managed: true,              // ãƒ•ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ‰
    integration: "AWSçµ±åˆãŒå®¹æ˜“"
  },
  cost: "ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ™ãƒ¼ã‚¹",
  setup: "CloudFormation/CDKå¯¾å¿œ"
}
```

#### 2. Amazon RDS for PostgreSQL + pgvector
```typescript
// RDSæ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨
{
  service: "RDS PostgreSQL + pgvector",
  features: {
    dimensions: 2000,           // æ¨å¥¨æœ€å¤§æ¬¡å…ƒæ•°
    sql_compatible: true,       // SQL ã‚¯ã‚¨ãƒªå¯èƒ½
    backup: "RDSè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—",
    scaling: "å‚ç›´ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°"
  },
  limitations: "å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã¯æ€§èƒ½åˆ¶é™ã‚ã‚Š"
}
```

#### 3. ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ï¼ˆPineconeï¼‰
```typescript
// SaaSå‹ãƒ™ã‚¯ãƒˆãƒ«DB
{
  service: "Pinecone",
  features: {
    serverless: true,           // ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹
    dimensions: 20000,          // é«˜æ¬¡å…ƒå¯¾å¿œ
    api_based: true,            // REST/gRPC API
    global_index: true          // ã‚°ãƒ­ãƒ¼ãƒãƒ«åˆ†æ•£
  },
  cost: "å¾“é‡èª²é‡‘ï¼ˆãƒ™ã‚¯ãƒˆãƒ«æ•°ãƒ™ãƒ¼ã‚¹ï¼‰",
  integration: "APIçµŒç”±"
}
```

### Azureç’°å¢ƒã§ã®é¸æŠè‚¢

#### 1. Azure Cognitive Searchï¼ˆæ¨å¥¨ï¼‰
```typescript
// Azure ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒ¼ãƒ“ã‚¹
{
  service: "Azure Cognitive Search",
  features: {
    vector_search: true,        // ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢æ©Ÿèƒ½
    dimensions: 4096,           // æœ€å¤§æ¬¡å…ƒæ•°
    hybrid_search: true,        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰+ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢
    managed: true,              // ãƒ•ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ‰
    ai_enrichment: true         // AI ã‚¨ãƒ³ãƒªãƒƒãƒãƒ¡ãƒ³ãƒˆ
  },
  cost: "ãƒ¦ãƒ‹ãƒƒãƒˆ/ãƒ¬ãƒ—ãƒªã‚«ãƒ™ãƒ¼ã‚¹",
  setup: "ARM Template/Terraformå¯¾å¿œ"
}
```

#### 2. Azure Cosmos DB for PostgreSQL + pgvector
```typescript
// Cosmos DB PostgreSQLç‰ˆ
{
  service: "Azure Cosmos DB for PostgreSQL",
  features: {
    distributed: true,          // åˆ†æ•£å‹
    pgvector: true,            // pgvectoræ‹¡å¼µå¯¾å¿œ
    global_distribution: true,  // ã‚°ãƒ­ãƒ¼ãƒãƒ«åˆ†æ•£
    consistency: "å¼·æ•´åˆæ€§ã‚ªãƒ—ã‚·ãƒ§ãƒ³"
  },
  scalability: "æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œ"
}
```

#### 3. Azure Database for PostgreSQL + pgvector
```typescript
// Azure PostgreSQL ã‚µãƒ¼ãƒ“ã‚¹
{
  service: "Azure Database for PostgreSQL",
  features: {
    flexible_server: true,      // ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ã‚µãƒ¼ãƒãƒ¼
    pgvector: true,            // pgvectoræ‹¡å¼µ
    backup: "è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—",
    high_availability: true     // é«˜å¯ç”¨æ€§
  },
  cost: "ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ™ãƒ¼ã‚¹"
}
```

### ãƒ™ã‚¯ãƒˆãƒ«DBã‚’ä½¿ã‚ãªã„é¸æŠè‚¢

#### ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®æ¤œç´¢ï¼ˆã‚·ãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼‰
```typescript
interface FileBasedVectorSearch {
  approach: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ™ãƒ¼ã‚¹",
  storage: {
    format: "Parquet + FAISS ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹",
    location: "S3/Blob Storage",
    structure: {
      embeddings: "chunks.parquet",      // ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ä¿å­˜
      index: "index.faiss"               // FAISSã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    }
  },
  
  // ãƒ¡ãƒªãƒƒãƒˆ
  pros: [
    "è¿½åŠ ã‚³ã‚¹ãƒˆãªã—ï¼ˆS3/Blob Storageã®ã¿ï¼‰",
    "ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…",
    "å°ã€œä¸­è¦æ¨¡ï¼ˆæ•°ä¸‡ãƒãƒ£ãƒ³ã‚¯ï¼‰ã§ã¯ååˆ†ãªæ€§èƒ½",
    "ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ãªã—"
  ],
  
  // ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
  cons: [
    "å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã¯æ¤œç´¢ãŒé…ã„",
    "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ›´æ–°æ™‚ã«å…¨ä½“å†æ§‹ç¯‰ãŒå¿…è¦",
    "ä¸¦è¡Œã‚¢ã‚¯ã‚»ã‚¹ã®åˆ¶å¾¡ãŒè¤‡é›‘",
    "ãƒ¡ãƒ¢ãƒªåˆ¶é™ï¼ˆLambda: 10GBï¼‰"
  ],
  
  // é©ç”¨ã‚±ãƒ¼ã‚¹
  suitable_for: [
    "ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ•°: ã€œ100",
    "ç·ãƒãƒ£ãƒ³ã‚¯æ•°: ã€œ50,000",
    "åŒæ™‚æ¤œç´¢ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€œ10"
  ]
}
```

#### å®Ÿè£…ä¾‹ï¼ˆFAISSä½¿ç”¨ï¼‰
```python
import faiss
import numpy as np
import pandas as pd
from typing import List, Tuple

class FileBasedVectorDB:
    def __init__(self, library_id: str):
        self.library_id = library_id
        self.s3_prefix = f"{library_id}/embeddings/"
        
    def search(self, query_embedding: np.ndarray, top_k: int = 10) -> List[Tuple[int, float]]:
        # 1. Parquetãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°èª­ã¿è¾¼ã¿
        embeddings_df = pd.read_parquet(f"s3://{bucket}/{self.s3_prefix}chunks.parquet")
        embeddings = np.array(embeddings_df['embedding'].tolist()).astype('float32')
        
        # 2. FAISSã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ§‹ç¯‰ï¼ˆã¾ãŸã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
        dimension = embeddings.shape[1]  # 3072
        index = faiss.IndexFlatIP(dimension)  # å†…ç©ï¼ˆã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ï¼‰
        faiss.normalize_L2(embeddings)  # æ­£è¦åŒ–
        index.add(embeddings)
        
        # 3. æ¤œç´¢å®Ÿè¡Œ
        faiss.normalize_L2(query_embedding.reshape(1, -1))
        scores, indices = index.search(query_embedding.reshape(1, -1), top_k)
        
        # 4. çµæœã‚’è¿”ã™
        return [(idx, score) for idx, score in zip(indices[0], scores[0])]
```

### æ¨å¥¨æ§‹æˆ

```typescript
interface RecommendedVectorDBConfig {
  // å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã€œ50,000ãƒãƒ£ãƒ³ã‚¯ï¼‰
  small_scale: {
    approach: "ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆFAISSï¼‰",
    reason: "ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒé«˜ãã€å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«",
    storage: "S3/Blob Storage ã®ã¿"
  },
  
  // ä¸­è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ50,000ã€œ500,000ãƒãƒ£ãƒ³ã‚¯ï¼‰
  medium_scale: {
    aws: "Amazon OpenSearch Service",
    azure: "Azure Cognitive Search",
    reason: "ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§é‹ç”¨è² è·è»½æ¸›"
  },
  
  // å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ500,000ãƒãƒ£ãƒ³ã‚¯ä»¥ä¸Šï¼‰
  large_scale: {
    primary: "Pinecone",
    aws_alternative: "Amazon OpenSearch Serviceï¼ˆè¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰",
    azure_alternative: "Azure Cosmos DB for PostgreSQL + pgvector",
    reason: "é«˜æ€§èƒ½ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£é‡è¦–"
  }
}
```

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹é€ 

#### S3/Azure Blob Storageæ§‹é€ 
```
{bucket-name}/
â”œâ”€â”€ {library-id}/
â”‚   â”œâ”€â”€ files/                    # å…ƒãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â””â”€â”€ {file-id}-{filename}
â”‚   â”œâ”€â”€ embeddings/               # ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â””â”€â”€ {file-id}/
â”‚   â”‚       â”œâ”€â”€ metadata.json     # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”‚   â”‚       â”œâ”€â”€ chunks.parquet    # ãƒãƒ£ãƒ³ã‚¯ã¨ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°
â”‚   â”‚       â””â”€â”€ index.faiss       # FAISSã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”‚   â””â”€â”€ feedback/                 # RAGãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
â”‚       â””â”€â”€ {year}/{month}/
â”‚           â””â”€â”€ {feedback-id}.json
```

#### DynamoDB/CosmosDBæ§‹é€ 
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
- ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–çŠ¶æ…‹ã‚’ç®¡ç†
- ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™æƒ…å ±ã‚’ä¿æŒ

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

```typescript
interface Library {
  // åŸºæœ¬æƒ…å ±
  library_id: UUID;                // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªID
  name: string;                    // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå
  description?: string;            // èª¬æ˜
  
  // ä½œæˆè€…æƒ…å ±
  created_by: UUID;                // ä½œæˆè€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  created_at: DateTime;            // ä½œæˆæ—¥æ™‚
  updated_at: DateTime;            // æ›´æ–°æ—¥æ™‚
  
  // çµ±è¨ˆæƒ…å ±
  file_count: number;              // ãƒ•ã‚¡ã‚¤ãƒ«æ•°
  total_size: number;              // ç·ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
  vectorized_count: number;        // ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Œäº†ãƒ•ã‚¡ã‚¤ãƒ«æ•°
  
  // å…¬é–‹ç¯„å›²
  visibility: LibraryVisibility;   // å…¬é–‹ç¯„å›²è¨­å®š
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  status: LibraryStatus;           // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  last_vectorized_at?: DateTime;   // æœ€çµ‚ãƒ™ã‚¯ãƒˆãƒ«åŒ–æ—¥æ™‚
}

type LibraryStatus = 
  | "active"        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
  | "processing"    // å‡¦ç†ä¸­
  | "archived";     // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ¸ˆã¿
```

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«

```typescript
interface LibraryFile {
  // åŸºæœ¬æƒ…å ±
  file_id: UUID;                   // ãƒ•ã‚¡ã‚¤ãƒ«ID
  library_id: UUID;                // æ‰€å±ãƒ©ã‚¤ãƒ–ãƒ©ãƒªID
  filename: string;                // ãƒ•ã‚¡ã‚¤ãƒ«å
  original_filename: string;       // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ•ã‚¡ã‚¤ãƒ«å
  
  // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±
  mime_type: string;               // MIMEã‚¿ã‚¤ãƒ—
  size: number;                    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
  file_hash: string;               // ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥ï¼ˆSHA-256ï¼‰
  storage_path: string;            // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‘ã‚¹
  
  // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æƒ…å ±
  uploaded_by: UUID;               // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  uploaded_at: DateTime;           // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚
  
  // ãƒ™ã‚¯ãƒˆãƒ«åŒ–æƒ…å ±
  vectorization_status: VectorizationStatus;  // ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  vectorized_at?: DateTime;        // ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Œäº†æ—¥æ™‚
  vectorization_error?: string;    // ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚¨ãƒ©ãƒ¼æƒ…å ±
  chunk_count?: number;            // ãƒãƒ£ãƒ³ã‚¯æ•°
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata?: FileMetadata;         // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
}

type VectorizationStatus = 
  | "pending"       // ãƒ™ã‚¯ãƒˆãƒ«åŒ–å¾…ã¡
  | "processing"    // ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†ä¸­
  | "completed"     // ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Œäº†
  | "failed"        // ãƒ™ã‚¯ãƒˆãƒ«åŒ–å¤±æ•—
  | "skipped";      // ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚¹ã‚­ãƒƒãƒ—ï¼ˆéå¯¾å¿œå½¢å¼ï¼‰
```

### ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿

#### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆmetadata.jsonï¼‰
```typescript
interface EmbeddingMetadata {
  file_id: string;                 // ãƒ•ã‚¡ã‚¤ãƒ«ID
  original_filename: string;       // å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«å
  embedding_model: "text-embedding-3-large";  // ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«
  dimensions: 3072;                // ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒæ•°
  total_chunks: number;            // ç·ãƒãƒ£ãƒ³ã‚¯æ•°
  total_tokens: number;            // ç·ãƒˆãƒ¼ã‚¯ãƒ³æ•°
  embedding_cost: number;          // ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ã‚³ã‚¹ãƒˆï¼ˆUSDï¼‰
  created_at: DateTime;            // ä½œæˆæ—¥æ™‚
  processing_time_ms: number;      // å‡¦ç†æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
}
```

#### ãƒãƒ£ãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆchunks.parquetï¼‰
```typescript
interface ChunkData {
  chunk_id: string;                // ãƒãƒ£ãƒ³ã‚¯ID
  chunk_index: number;             // ãƒãƒ£ãƒ³ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  text: string;                    // ãƒãƒ£ãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ
  embedding: Float32Array;         // åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆ3072æ¬¡å…ƒï¼‰
  token_count: number;             // ãƒˆãƒ¼ã‚¯ãƒ³æ•°
  metadata: {
    start_char: number;            // é–‹å§‹æ–‡å­—ä½ç½®
    end_char: number;              // çµ‚äº†æ–‡å­—ä½ç½®
    page_number?: number;          // ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆPDFã®å ´åˆï¼‰
    section_title?: string;        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³å
  };
}
```

### RAGãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

```typescript
interface RAGFeedback {
  // è­˜åˆ¥æƒ…å ±
  feedback_id: UUID;               // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ID
  library_id: UUID;                // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªID
  user_id: UUID;                   // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡è€…ID
  
  // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¯¾è±¡
  query: string;                    // å…ƒã®æ¤œç´¢ã‚¯ã‚¨ãƒª
  response: string;                 // ç”Ÿæˆã•ã‚ŒãŸå›ç­”
  
  // å‚ç…§ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯
  referenced_chunks: Array<{
    file_id: string;                // ãƒ•ã‚¡ã‚¤ãƒ«ID
    chunk_id: string;               // ãƒãƒ£ãƒ³ã‚¯ID
    text: string;                   // ãƒãƒ£ãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ
    score: number;                  // é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢
  }>;
  
  // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å†…å®¹
  rating: 'good' | 'bad';          // è©•ä¾¡ï¼ˆGood/Badï¼‰
  comment?: string;                // ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆæœ€å¤§1000æ–‡å­—ï¼‰
  
  // æ”¹å–„ææ¡ˆ
  suggestions?: {
    missing_info?: string;          // ä¸è¶³ã—ã¦ã„ãŸæƒ…å ±
    incorrect_info?: string;        // èª¤ã£ã¦ã„ãŸæƒ…å ±
    expected_response?: string;     // æœŸå¾…ã—ã¦ã„ãŸå›ç­”
  };
  
  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
  created_at: DateTime;             // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ—¥æ™‚
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  chat_id?: UUID;                  // é–¢é€£ã™ã‚‹ãƒãƒ£ãƒƒãƒˆID
  message_id?: UUID;                // é–¢é€£ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID
  model_used?: string;              // ä½¿ç”¨ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«
  temperature?: number;             // ç”Ÿæˆæ™‚ã®æ¸©åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
}
```

## å…¬é–‹ç¯„å›²ã®ä»•æ§˜

### å…¬é–‹ç¯„å›²ã®ç¨®é¡

```typescript
interface LibraryVisibility {
  // å…¬é–‹ã‚¿ã‚¤ãƒ—
  visibility_type: VisibilityType;
  
  // éƒ¨ç½²æŒ‡å®šï¼ˆANDæ¡ä»¶ï¼‰
  departments?: string[];          // éƒ¨ç½²åãƒªã‚¹ãƒˆ
  
  // å½¹è·æŒ‡å®šï¼ˆANDæ¡ä»¶ï¼‰
  roles?: string[];                // å½¹è·åãƒªã‚¹ãƒˆ
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šï¼ˆORæ¡ä»¶ï¼‰
  users?: UUID[];                  // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒªã‚¹ãƒˆ
}

type VisibilityType = 
  | "private"       // ä½œæˆè€…ã®ã¿
  | "specific"      // ç‰¹å®šã®æ¡ä»¶æŒ‡å®š
  | "tenant";       // ãƒ†ãƒŠãƒ³ãƒˆå…¨ä½“
```

### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯

ã‚¢ã‚¯ã‚»ã‚¹å¯å¦ã®åˆ¤å®šã¯ä»¥ä¸‹ã®ãƒ­ã‚¸ãƒƒã‚¯ã§è¡Œã„ã¾ã™ï¼š

1. **visibility_type = "private"ã®å ´åˆ**
   - ä½œæˆè€…æœ¬äººã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

2. **visibility_type = "specific"ã®å ´åˆ**
   - ä»¥ä¸‹ã®æ¡ä»¶ã‚’ã™ã¹ã¦æº€ãŸã™å ´åˆã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼š
     - éƒ¨ç½²æ¡ä»¶ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®éƒ¨ç½²ãŒ`departments`é…åˆ—ã®ã„ãšã‚Œã‹ã«å«ã¾ã‚Œã‚‹ï¼ˆæŒ‡å®šãŒãªã„å ´åˆã¯æ¡ä»¶ãªã—ï¼‰
     - å½¹è·æ¡ä»¶ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹è·ãŒ`roles`é…åˆ—ã®ã„ãšã‚Œã‹ã«å«ã¾ã‚Œã‚‹ï¼ˆæŒ‡å®šãŒãªã„å ´åˆã¯æ¡ä»¶ãªã—ï¼‰
   - ã¾ãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒ`users`é…åˆ—ã«å«ã¾ã‚Œã‚‹å ´åˆã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

3. **visibility_type = "tenant"ã®å ´åˆ**
   - åŒä¸€ãƒ†ãƒŠãƒ³ãƒˆã®å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

```typescript
// ã‚¢ã‚¯ã‚»ã‚¹å¯å¦åˆ¤å®šã®ä¾‹
function canAccessLibrary(library: Library, user: User): boolean {
  const visibility = library.visibility;
  
  // ä½œæˆè€…ã¯å¸¸ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
  if (library.created_by === user.user_id) {
    return true;
  }
  
  switch (visibility.visibility_type) {
    case "private":
      return false;
      
    case "specific":
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šãƒã‚§ãƒƒã‚¯ï¼ˆORæ¡ä»¶ï¼‰
      if (visibility.users?.includes(user.user_id)) {
        return true;
      }
      
      // éƒ¨ç½²ãƒ»å½¹è·ãƒã‚§ãƒƒã‚¯ï¼ˆANDæ¡ä»¶ï¼‰
      const deptMatch = !visibility.departments || 
                        visibility.departments.includes(user.department);
      const roleMatch = !visibility.roles || 
                        visibility.roles.includes(user.role);
      return deptMatch && roleMatch;
      
    case "tenant":
      return user.tenant_id === library.tenant_id;
      
    default:
      return false;
  }
}
```

## å‡¦ç†ãƒ•ãƒ­ãƒ¼

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant API as API Gateway
    participant DDB as DynamoDB/<br/>CosmosDB
    participant S3 as S3/Blob<br/>Storage
    participant Queue as SQS/<br/>Queue
    participant Lambda as Lambda/<br/>Functions

    User->>API: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    Note over User,API: multipart/form-data
    
    API->>API: ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼
    Note over API: MIME type, ã‚µã‚¤ã‚º, ã‚¦ã‚¤ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    
    API->>S3: ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    Note over S3: {library-id}/files/<br/>{file-id}-{filename}
    
    API->>DDB: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    Note over DDB: status: "pending"
    
    API->>Queue: ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚¸ãƒ§ãƒ–ç™»éŒ²
    Note over Queue: file_id, library_id
    
    API-->>User: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†
    Note over User,API: file_id, statusè¿”å´
    
    Queue->>Lambda: ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†ãƒˆãƒªã‚¬ãƒ¼
```

### ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†

#### ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³

```mermaid
flowchart TB
    Start[ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚¸ãƒ§ãƒ–é–‹å§‹] --> GetFile[S3ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—]
    GetFile --> Extract{ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¤å®š}
    
    Extract -->|PDF| ExtractPDF[PDFãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º]
    Extract -->|Office| ExtractOffice[Officeæ–‡æ›¸<br/>ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º]
    Extract -->|Text| ExtractText[ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ<br/>èª­ã¿è¾¼ã¿]
    
    ExtractPDF --> Chunk[ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²]
    ExtractOffice --> Chunk
    ExtractText --> Chunk
    
    Chunk --> Batch[ãƒãƒƒãƒä½œæˆ<br/>max 100ãƒãƒ£ãƒ³ã‚¯]
    
    Batch --> Embed[OpenAI APIå‘¼ã³å‡ºã—<br/>text-embedding-3-large]
    
    Embed --> Save1[Parquetãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜<br/>S3: chunks.parquet]
    Save1 --> Save2[ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜<br/>S3: metadata.json]
    Save2 --> IndexVDB[ãƒ™ã‚¯ãƒˆãƒ«DBç™»éŒ²<br/>Pinecone/Weaviate]
    
    IndexVDB --> UpdateStatus[ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°<br/>DynamoDB]
    UpdateStatus --> End[å‡¦ç†å®Œäº†]
    
    Embed -->|ã‚¨ãƒ©ãƒ¼| ErrorHandler[ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°]
    ErrorHandler --> UpdateError[ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹æ›´æ–°<br/>DynamoDB]
    UpdateError --> End
```

#### å‡¦ç†è©³ç´°

1. **ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º**
   - PDFã‹ã‚‰ã®ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
   - Officeæ–‡æ›¸ã‹ã‚‰ã®ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
   - ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®èª­ã¿è¾¼ã¿

2. **ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²**
   ```typescript
   interface ChunkingStrategy {
     strategy: "sliding_window";
     chunk_size: 1000;           // æ–‡å­—æ•°
     overlap: 200;               // ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—æ–‡å­—æ•°
     max_chunk_tokens: 256;      // æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°
   }
   ```

3. **åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆ**
   ```typescript
   // OpenAI text-embedding-3-largeã‚’ä½¿ç”¨
   const response = await openai.embeddings.create({
     model: "text-embedding-3-large",
     input: chunkTexts,  // ãƒãƒƒãƒå‡¦ç†
   });
   ```
   - ã‚³ã‚¹ãƒˆ: $0.13/1M tokens
   - æ¬¡å…ƒæ•°: 3072
   - ãƒ¬ãƒ¼ãƒˆåˆ¶é™: 3,000 RPM / 1,000,000 TPM

4. **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**
   - S3/Blob: Parquetå½¢å¼ã§ãƒãƒ£ãƒ³ã‚¯ã¨ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä¿å­˜
   - ãƒ™ã‚¯ãƒˆãƒ«DB: é«˜é€Ÿæ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆPinecone/Weaviateï¼‰
   - DynamoDB/CosmosDB: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨çŠ¶æ…‹ç®¡ç†

### RAGæ¤œç´¢

#### RAGæ¤œç´¢ãƒ•ãƒ­ãƒ¼å›³

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant API as API Gateway
    participant Auth as èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹
    participant Embed as OpenAI<br/>Embedding API
    participant FAISS as FAISS<br/>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    participant S3 as S3/Blob<br/>Storage
    participant DDB as DynamoDB/<br/>CosmosDB
    participant LLM as LLM<br/>(Claude/GPT)

    User->>API: æ¤œç´¢ã‚¯ã‚¨ãƒªé€ä¿¡
    API->>Auth: ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ç¢ºèª
    Auth->>DDB: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™å–å¾—
    DDB-->>Auth: æ¨©é™æƒ…å ±
    Auth-->>API: ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãƒ©ã‚¤ãƒ–ãƒ©ãƒªID

    API->>Embed: text-embedding-3-large
    Note over Embed: 3072æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆ
    Embed-->>API: ã‚¯ã‚¨ãƒªã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°

    API->>S3: FAISSã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹èª­ã¿è¾¼ã¿
    API->>FAISS: ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢å®Ÿè¡Œ
    Note over FAISS: library_id IN [...]<br/>ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    FAISS-->>API: é¡ä¼¼ãƒãƒ£ãƒ³ã‚¯ID+ã‚¹ã‚³ã‚¢

    API->>S3: ãƒãƒ£ãƒ³ã‚¯è©³ç´°å–å¾—
    Note over S3: embeddings/{file-id}/<br/>chunks.parquet
    S3-->>API: ãƒãƒ£ãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ

    API->>API: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰
    Note over API: ãƒˆãƒ¼ã‚¯ãƒ³æ•°åˆ¶é™å†…ã§<br/>é–¢é€£æ€§ã®é«˜ã„é †ã«çµåˆ

    API->>LLM: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ+ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
    LLM-->>API: ç”Ÿæˆçµæœ
    API-->>User: æ¤œç´¢çµæœ+ç”Ÿæˆå›ç­”
```

#### å˜ä¸€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¤œç´¢
```typescript
interface SingleLibrarySearch {
  // 1. ã‚¯ã‚¨ãƒªã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–
  queryEmbedding: Float32Array;  // 3072æ¬¡å…ƒ
  
  // 2. ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢
  searchResults: {
    chunk_id: string;
    score: number;        // ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦
    metadata: ChunkMetadata;
  }[];
  
  // 3. ãƒãƒ£ãƒ³ã‚¯è©³ç´°å–å¾—
  chunks: ChunkData[];
  
  // 4. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
  context: string;
}
```

#### è¤‡æ•°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¤œç´¢
```typescript
class MultiLibraryRAGSearch {
  async search(
    query: string,
    libraryIds: string[],
    options: {
      topK?: number;          // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10
      threshold?: number;     // é¡ä¼¼åº¦é–¾å€¤: 0.7
      maxTokens?: number;     // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°: 4000
    }
  ): Promise<RAGSearchResult> {
    // 1. ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒã‚§ãƒƒã‚¯
    const accessibleLibraries = await this.filterAccessibleLibraries(
      libraryIds,
      userId
    );
    
    // 2. ã‚¯ã‚¨ãƒªã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèªï¼‰
    const queryEmbedding = await this.embedQuery(query);
    
    // 3. ãƒ™ã‚¯ãƒˆãƒ«DBæ¤œç´¢ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼ï¼‰
    const searchResults = await this.vectorDB.search({
      vector: queryEmbedding,
      filter: {
        library_id: { $in: accessibleLibraries }
      },
      top_k: options.topK * 2,
      include_metadata: true
    });
    
    // 4. ã‚¹ã‚³ã‚¢ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    const filtered = this.filterAndRerank(
      searchResults,
      options.threshold
    );
    
    // 5. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰
    return this.buildContext(filtered, options.maxTokens);
  }
}
```

### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant UI as ãƒãƒ£ãƒƒãƒˆUI
    participant API as API Gateway
    participant FB as Feedback Service
    participant S3 as S3/Blob Storage
    participant DDB as DynamoDB/<br/>CosmosDB

    Note over User,UI: RAGå›ç­”è¡¨ç¤ºå¾Œ
    UI->>UI: Good/Badãƒœã‚¿ãƒ³è¡¨ç¤º
    
    User->>UI: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    UI->>UI: ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    User->>UI: ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ï¼ˆä»»æ„ï¼‰
    
    UI->>API: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡
    Note over API: {rating, comment, query,<br/>response, chunks}
    
    API->>FB: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å‡¦ç†
    FB->>FB: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯IDç”Ÿæˆ
    
    FB->>S3: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¿å­˜
    Note over S3: {library-id}/feedback/<br/>{year}/{month}/<br/>{feedback-id}.json
    
    FB->>DDB: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯çµ±è¨ˆæ›´æ–°
    Note over DDB: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯<br/>ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
    
    FB-->>API: ä¿å­˜å®Œäº†
    API-->>UI: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    UI-->>User: æ„Ÿè¬ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
```

## RAGãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ©Ÿèƒ½

### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯UI

ãƒãƒ£ãƒƒãƒˆç”»é¢ã§RAGã‚’ä½¿ç”¨ã—ãŸå›ç­”ãŒç”Ÿæˆã•ã‚ŒãŸå ´åˆã€ä»¥ä¸‹ã®UIã‚’è¡¨ç¤ºï¼š

```typescript
interface RAGFeedbackUI {
  // è¡¨ç¤ºæ¡ä»¶
  show_condition: {
    has_rag_context: boolean;       // RAGã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒä½¿ç”¨ã•ã‚ŒãŸ
    response_completed: boolean;    // å›ç­”ç”ŸæˆãŒå®Œäº†
  };
  
  // UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  components: {
    // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒœã‚¿ãƒ³
    feedback_buttons: {
      good_button: {
        icon: "ğŸ‘" | "thumb_up";
        label: "å½¹ã«ç«‹ã£ãŸ";
        color: "green";
      };
      bad_button: {
        icon: "ğŸ‘" | "thumb_down";
        label: "æ”¹å–„ãŒå¿…è¦";
        color: "red";
      };
    };
    
    // ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«
    comment_modal: {
      title: "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™";
      placeholder: "å…·ä½“çš„ãªæ”¹å–„ç‚¹ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰";
      max_length: 1000;
      
      // Badã®å ´åˆã®è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
      bad_feedback_fields?: {
        missing_info: {
          label: "ä¸è¶³ã—ã¦ã„ãŸæƒ…å ±";
          type: "textarea";
        };
        incorrect_info: {
          label: "èª¤ã£ã¦ã„ãŸæƒ…å ±";
          type: "textarea";
        };
        expected_response: {
          label: "æœŸå¾…ã—ã¦ã„ãŸå›ç­”";
          type: "textarea";
        };
      };
    };
    
    // é€ä¿¡å¾Œã®è¡¨ç¤º
    thank_you_message: {
      text: "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãŠé€ã‚Šã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å“è³ªæ”¹å–„ã«æ´»ç”¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚";
      duration: 3000;  // è¡¨ç¤ºæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
    };
  };
  
  // å‹•ä½œè¨­å®š
  behavior: {
    one_time_only: boolean;         // 1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¤ã1å›ã®ã¿
    anonymous_allowed: boolean;     // åŒ¿åãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¨±å¯
    require_comment_for_bad: boolean; // Badè©•ä¾¡æ™‚ã¯ã‚³ãƒ¡ãƒ³ãƒˆå¿…é ˆ
  };
}
```

### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç®¡ç†

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†ç”»é¢ã§ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç®¡ç†æ©Ÿèƒ½ï¼š

```typescript
interface FeedbackManagement {
  // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¸€è¦§è¡¨ç¤º
  feedback_list: {
    columns: [
      "æ—¥æ™‚",
      "è©•ä¾¡",
      "ã‚¯ã‚¨ãƒª",
      "ã‚³ãƒ¡ãƒ³ãƒˆ",
      "ãƒ¦ãƒ¼ã‚¶ãƒ¼"
    ];
    
    filters: {
      date_range: DateRange;        // æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
      rating: 'all' | 'good' | 'bad'; // è©•ä¾¡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
      has_comment: boolean;          // ã‚³ãƒ¡ãƒ³ãƒˆæœ‰ç„¡
    };
    
    sort: {
      field: 'created_at' | 'rating';
      order: 'asc' | 'desc';
    };
  };
  
  // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯çµ±è¨ˆ
  statistics: {
    total_count: number;            // ç·ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ•°
    good_count: number;             // Goodè©•ä¾¡æ•°
    bad_count: number;              // Badè©•ä¾¡æ•°
    satisfaction_rate: number;      // æº€è¶³åº¦ï¼ˆ%ï¼‰
    
    // æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•
    trend_chart: {
      type: 'line' | 'bar';
      period: 'daily' | 'weekly' | 'monthly';
      metrics: ['total', 'good', 'bad', 'satisfaction_rate'];
    };
    
    // ã‚ˆãã‚ã‚‹å•é¡Œ
    common_issues: Array<{
      issue_type: string;
      count: number;
      percentage: number;
    }>;
  };
  
  // ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½
  bulk_delete: {
    // å‰Šé™¤å¯¾è±¡ã®é¸æŠ
    selection_options: {
      all: boolean;                 // å…¨ä»¶å‰Šé™¤
      date_range: DateRange;        // æœŸé–“æŒ‡å®š
      rating_filter: 'good' | 'bad'; // è©•ä¾¡æŒ‡å®š
    };
    
    // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    confirmation: {
      title: "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å‰Šé™¤ç¢ºèª";
      message: "é¸æŠã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚";
      show_count: boolean;          // å‰Šé™¤ä»¶æ•°ã‚’è¡¨ç¤º
      require_confirmation_text: string; // "DELETE"ã¨å…¥åŠ›ã•ã›ã‚‹
    };
    
    // å‰Šé™¤å®Ÿè¡Œ
    delete_action: {
      soft_delete: boolean;         // è«–ç†å‰Šé™¤
      archive_before_delete: boolean; // å‰Šé™¤å‰ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
      log_deletion: boolean;        // å‰Šé™¤ãƒ­ã‚°ã‚’è¨˜éŒ²
    };
  };
  
  // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
  export: {
    formats: ['csv', 'json', 'excel'];
    include_options: {
      include_chunks: boolean;      // ãƒãƒ£ãƒ³ã‚¯æƒ…å ±ã‚’å«ã‚ã‚‹
      include_response: boolean;    // ç”Ÿæˆã•ã‚ŒãŸå›ç­”ã‚’å«ã‚ã‚‹
      anonymize: boolean;           // å€‹äººæƒ…å ±ã‚’åŒ¿ååŒ–
    };
  };
}
```

## APIä»•æ§˜

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

1. **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†**
   - `GET /api/libraries` - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§å–å¾—
   - `POST /api/libraries` - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œæˆ
   - `GET /api/libraries/{library_id}` - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè©³ç´°å–å¾—
   - `PUT /api/libraries/{library_id}` - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°
   - `DELETE /api/libraries/{library_id}` - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå‰Šé™¤

2. **ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†**
   - `POST /api/libraries/{library_id}/files` - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - `GET /api/libraries/{library_id}/files` - ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—
   - `DELETE /api/libraries/{library_id}/files/{file_id}` - ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

3. **ãƒ™ã‚¯ãƒˆãƒ«åŒ–ç®¡ç†**
   - `POST /api/libraries/{library_id}/vectorize` - ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Ÿè¡Œ
   - `GET /api/libraries/{library_id}/vectorization-status` - ãƒ™ã‚¯ãƒˆãƒ«åŒ–çŠ¶æ…‹å–å¾—

4. **æ¤œç´¢**
   - `POST /api/libraries/search` - è¤‡æ•°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¨ªæ–­æ¤œç´¢
   - `POST /api/libraries/{library_id}/search` - ç‰¹å®šãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…æ¤œç´¢

5. **RAGãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**
   - `POST /api/libraries/{library_id}/feedback` - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡
   - `GET /api/libraries/{library_id}/feedback` - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¸€è¦§å–å¾—
   - `GET /api/libraries/{library_id}/feedback/stats` - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯çµ±è¨ˆå–å¾—
   - `DELETE /api/libraries/{library_id}/feedback` - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¸€æ‹¬å‰Šé™¤
   - `GET /api/libraries/{library_id}/feedback/export` - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### æ¤œç´¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹
```typescript
interface LibrarySearchRequest {
  query: string;                  // æ¤œç´¢ã‚¯ã‚¨ãƒª
  library_ids?: string[];         // å¯¾è±¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒªIDï¼ˆçœç•¥æ™‚ã¯å…¨ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
  options?: {
    top_k?: number;               // å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰
    threshold?: number;           // é¡ä¼¼åº¦é–¾å€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.7ï¼‰
    include_metadata?: boolean;   // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å«æœ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰
  };
}
```

### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹

#### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡
```typescript
// POST /api/libraries/{library_id}/feedback
interface SubmitFeedbackRequest {
  query: string;                    // å…ƒã®æ¤œç´¢ã‚¯ã‚¨ãƒª
  response: string;                 // ç”Ÿæˆã•ã‚ŒãŸå›ç­”
  referenced_chunks: Array<{        // å‚ç…§ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯
    file_id: string;
    chunk_id: string;
    text: string;
    score: number;
  }>;
  rating: 'good' | 'bad';          // è©•ä¾¡
  comment?: string;                // ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  suggestions?: {                   // æ”¹å–„ææ¡ˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    missing_info?: string;
    incorrect_info?: string;
    expected_response?: string;
  };
  chat_id?: string;                // é–¢é€£ã™ã‚‹ãƒãƒ£ãƒƒãƒˆID
  message_id?: string;             // é–¢é€£ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID
}
```

#### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¸€æ‹¬å‰Šé™¤
```typescript
// DELETE /api/libraries/{library_id}/feedback
interface BulkDeleteFeedbackRequest {
  delete_all?: boolean;            // å…¨ä»¶å‰Šé™¤
  date_range?: {                   // æœŸé–“æŒ‡å®šå‰Šé™¤
    from: string;                  // é–‹å§‹æ—¥ï¼ˆISO 8601ï¼‰
    to: string;                    // çµ‚äº†æ—¥ï¼ˆISO 8601ï¼‰
  };
  rating?: 'good' | 'bad';         // è©•ä¾¡ã«ã‚ˆã‚‹å‰Šé™¤
  confirmation_text: string;       // ç¢ºèªãƒ†ã‚­ã‚¹ãƒˆï¼ˆ"DELETE"ï¼‰
}
```

## ã‚³ã‚¹ãƒˆæœ€é©åŒ–

### ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ã‚³ã‚¹ãƒˆç®¡ç†
```typescript
interface CostOptimization {
  // ãƒãƒƒãƒå‡¦ç†
  batch_processing: {
    batch_size: 100;              // ä¸€åº¦ã«å‡¦ç†ã™ã‚‹ãƒãƒ£ãƒ³ã‚¯æ•°
    rate_limit_buffer: 0.8;       // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®80%ã§åˆ¶å¾¡
  };
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥
  caching: {
    query_embeddings: {
      ttl: 3600;                  // 1æ™‚é–“
      max_size: 10000;            // æœ€å¤§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ•°
    };
    search_results: {
      ttl: 300;                   // 5åˆ†
      key: "query_hash:library_ids_hash";
    };
  };
  
  // ã‚³ã‚¹ãƒˆè¿½è·¡
  cost_tracking: {
    track_per_file: true;
    track_per_library: true;
    alert_threshold: 100;         // $100/æ—¥ã‚’è¶…ãˆãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆ
  };
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å³æ ¼ãªå®Ÿæ–½**
   - ã™ã¹ã¦ã®APIã§ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ãƒã‚§ãƒƒã‚¯
   - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¬ãƒ™ãƒ«ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¬ãƒ™ãƒ«ã§ã®äºŒé‡ãƒã‚§ãƒƒã‚¯

2. **ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–**
   - ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯æš—å·åŒ–
   - ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã‚‚æš—å·åŒ–ä¿å­˜

3. **ç›£æŸ»ãƒ­ã‚°**
   - ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
   - èª°ãŒã„ã¤ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‹ã‚’è¿½è·¡å¯èƒ½

4. **ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢**
   - ãƒ†ãƒŠãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«åˆ†é›¢
   - ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚‚ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã‚’å®Ÿæ–½

## æ›´æ–°å±¥æ­´

- 2025-08-05: åˆç‰ˆä½œæˆï¼ˆRAGç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜ï¼‰